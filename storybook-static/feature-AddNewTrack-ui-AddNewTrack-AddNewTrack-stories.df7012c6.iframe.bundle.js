"use strict";(self.webpackChunkmu_cloud=self.webpackChunkmu_cloud||[]).push([[6438],{"./src/feature/AddNewTrack/ui/AddNewTrack/AddNewTrack.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Idle:()=>Idle,Loading:()=>Loading,default:()=>AddNewTrack_stories});var defineProperty=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/defineProperty.js"),backendUrl=__webpack_require__("./src/shared/const/backendUrl.ts"),StoreDecorator=__webpack_require__("./src/shared/config/storybook/StoreDecorator/StoreDecorator.tsx"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),es=__webpack_require__("./node_modules/react-redux/es/index.js"),DynamicModuleLoader=__webpack_require__("./src/shared/config/DynamicModuleLoader/DynamicModuleLoader.tsx"),fileStorage=__webpack_require__("./src/entity/fileStorage/index.ts"),ui_Form=__webpack_require__("./src/shared/ui/Form/index.ts"),injectStylesIntoStyleTag=__webpack_require__("./node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js"),injectStylesIntoStyleTag_default=__webpack_require__.n(injectStylesIntoStyleTag),styleDomAPI=__webpack_require__("./node_modules/style-loader/dist/runtime/styleDomAPI.js"),styleDomAPI_default=__webpack_require__.n(styleDomAPI),insertBySelector=__webpack_require__("./node_modules/style-loader/dist/runtime/insertBySelector.js"),insertBySelector_default=__webpack_require__.n(insertBySelector),setAttributesWithoutAttributes=__webpack_require__("./node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js"),setAttributesWithoutAttributes_default=__webpack_require__.n(setAttributesWithoutAttributes),insertStyleElement=__webpack_require__("./node_modules/style-loader/dist/runtime/insertStyleElement.js"),insertStyleElement_default=__webpack_require__.n(insertStyleElement),styleTagTransform=__webpack_require__("./node_modules/style-loader/dist/runtime/styleTagTransform.js"),styleTagTransform_default=__webpack_require__.n(styleTagTransform),Form_module=__webpack_require__("./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[13].use[1]!./node_modules/postcss-loader/dist/cjs.js!./node_modules/resolve-url-loader/index.js!./node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[13].use[4]!./src/feature/AddNewTrack/ui/AddNewTrack/Form/Form.module.scss"),options={};options.styleTagTransform=styleTagTransform_default(),options.setAttributes=setAttributesWithoutAttributes_default(),options.insert=insertBySelector_default().bind(null,"head"),options.domAPI=styleDomAPI_default(),options.insertStyleElement=insertStyleElement_default();injectStylesIntoStyleTag_default()(Form_module.Z,options);const Form_Form_module=Form_module.Z&&Form_module.Z.locals?Form_module.Z.locals:void 0;var getName=function getName(state){var _state$addNewTrack;return null==state||null===(_state$addNewTrack=state.addNewTrack)||void 0===_state$addNewTrack?void 0:_state$addNewTrack.name},store=__webpack_require__("./src/global/providers/StoreProvider/config/store.ts"),Input=__webpack_require__("./src/shared/ui/Input/index.ts"),checkError=__webpack_require__("./src/shared/lib/helpers/checkError/checkError.ts"),getIsNameValidationError=function getIsNameValidationError(state){var _state$addNewTrack,errors=null==state||null===(_state$addNewTrack=state.addNewTrack)||void 0===_state$addNewTrack?void 0:_state$addNewTrack.validationErrors.name;return(0,checkError.r)(errors)},getStatus=function getStatus(state){var _state$addNewTrack;return null===(_state$addNewTrack=state.addNewTrack)||void 0===_state$addNewTrack?void 0:_state$addNewTrack.status},asyncToGenerator=__webpack_require__("./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js"),regenerator=__webpack_require__("./node_modules/@babel/runtime/regenerator/index.js"),regenerator_default=__webpack_require__.n(regenerator),redux_toolkit_esm=__webpack_require__("./node_modules/@reduxjs/toolkit/dist/redux-toolkit.esm.js"),config={name:{messages:{empty:"Название не должно быть пустым",exceedsMaxLenght:"Длина названия должна быть не более 15 символов"},maxLenght:15},name_secondary:{messages:{exceedsMaxLenght:"Длина подписи должна быть не более 15 символов"},maxLenght:15},audioFile:{messages:{empty:"Аудиофайл не выбран",invalidMimeType:"Данный тип аудиофайла не поддерживается. Возможно использование аудифайлов c расширением mp3, wav или weba"},validMimeTypes:["audio/mpeg","audio/wav","audio/webm"]},imageFile:{messages:{empty:"Изображение не выбрано",invalidMimeType:"Данный тип изображения не поддерживается. Возможно использование файлов c расширением jpeg, jpg, png или webp"},validMimeTypes:["image/jpeg","image/png","image/webp"]},imageCroppedSquareFile:{messages:{empty:"Изображение должно быть откадрировано в формате 1:1"}},imageCroppedWideFile:{messages:{empty:"Изображение должно быть откадрировано в формате 9:16"}}},AddNewTrackSlice=(0,redux_toolkit_esm.oM)({name:"AddNewTrack",initialState:{validationErrors:{name:{empty:!1,exceedsMaxLenght:!1},name_secondary:{exceedsMaxLenght:!1},audioFile:{invalidMimeType:!1,empty:!1},imageFile:{invalidMimeType:!1,empty:!1},imageCroppedSquareFile:{empty:!1},imageCroppedWideFile:{empty:!1}},tab:"form",status:"idle"},reducers:{validateName:function validateName(state,action){var name=action.payload;if(!name)return state.validationErrors.name.empty=!0,void(state.validationErrors.name.exceedsMaxLenght=!1);state.validationErrors.name.empty=!1,name.length>config.name.maxLenght?state.validationErrors.name.exceedsMaxLenght=!0:state.validationErrors.name.exceedsMaxLenght=!1},setName:function setName(state,action){state.name=action.payload},validateNameSecondary:function validateNameSecondary(state,action){var name_secondary=action.payload;name_secondary&&name_secondary.length>config.name_secondary.maxLenght?state.validationErrors.name_secondary.exceedsMaxLenght=!0:state.validationErrors.name_secondary.exceedsMaxLenght=!1},setNameSecondary:function setNameSecondary(state,action){state.name_secondary=action.payload},validateAudioFileMimeType:function validateAudioFileMimeType(state,action){var value=action.payload;if(!value)return state.validationErrors.audioFile.invalidMimeType=!1,void(state.validationErrors.audioFile.empty=!0);state.validationErrors.audioFile.empty=!1,config.audioFile.validMimeTypes.includes(value)?state.validationErrors.audioFile.invalidMimeType=!1:state.validationErrors.audioFile.invalidMimeType=!0},setAudioFileMimeType:function setAudioFileMimeType(state,action){state.audioFileMimeType=action.payload},validateImageFileMimeType:function validateImageFileMimeType(state,action){var value=action.payload;if(!value)return state.validationErrors.imageFile.invalidMimeType=!1,void(state.validationErrors.imageFile.empty=!0);state.validationErrors.imageFile.empty=!1,config.imageFile.validMimeTypes.includes(value)?state.validationErrors.imageFile.invalidMimeType=!1:state.validationErrors.imageFile.invalidMimeType=!0},setImageFileMimeType:function setImageFileMimeType(state,action){state.imageFileMimeType=action.payload},setImageCroppedWideFileMimeType:function setImageCroppedWideFileMimeType(state,action){state.imageFileMimeType=action.payload},validateImageCroppedWideFileMimeType:function validateImageCroppedWideFileMimeType(state,action){action.payload?state.validationErrors.imageCroppedWideFile.empty=!1:state.validationErrors.imageCroppedWideFile.empty=!0},setImageCroppedSquareFileMimeType:function setImageCroppedSquareFileMimeType(state,action){state.imageFileMimeType=action.payload},validateImageCroppedSquareFileMimeType:function validateImageCroppedSquareFileMimeType(state,action){action.payload?state.validationErrors.imageCroppedSquareFile.empty=!1:state.validationErrors.imageCroppedSquareFile.empty=!0},setTab:function setTab(state,action){state.tab=action.payload},startLoad:function startLoad(state){state.status="loading"},setIdle:function setIdle(state){state.status="idle"},reset:function reset(state){state.name="",state.name_secondary="",state.audioFileMimeType=void 0,state.imageCroppedSquareMimeType=void 0,state.imageCroppedWideMimeType=void 0,state.imageFileMimeType=void 0,state.validationErrors.audioFile.empty=!1,state.validationErrors.audioFile.invalidMimeType=!1,state.validationErrors.imageCroppedSquareFile.empty=!1,state.validationErrors.imageCroppedWideFile.empty=!1,state.validationErrors.imageFile.empty=!1,state.validationErrors.imageFile.invalidMimeType=!1,state.validationErrors.name.empty=!1,state.validationErrors.name.exceedsMaxLenght=!1,state.validationErrors.name_secondary.exceedsMaxLenght=!1}}}),AddNewTrackActions=AddNewTrackSlice.actions,AddNewTrackReducer=AddNewTrackSlice.reducer,setName=(0,redux_toolkit_esm.hg)("AddNewTrack/setName",function(){var _ref=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee(name,thunkApi){var dispatch;return regenerator_default().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(dispatch=thunkApi.dispatch," "!==name[0]){_context.next=3;break}return _context.abrupt("return");case 3:if(" "!==name[name.length-1]){_context.next=5;break}return _context.abrupt("return");case 5:dispatch(AddNewTrackActions.validateName(name)),dispatch(AddNewTrackActions.setName(name));case 7:case"end":return _context.stop()}}),_callee)})));return function(_x,_x2){return _ref.apply(this,arguments)}}()),__jsx=react.createElement,NameInput=(0,react.memo)((function(props){var dispatch=(0,store.T)(),name=(0,es.v9)(getName),status=(0,es.v9)(getStatus),isError=(0,es.v9)(getIsNameValidationError),onChange=(0,react.useCallback)((function(e){dispatch(setName(e.target.value))}),[dispatch]);return __jsx(Input.I,{value:name,onChange,label:"Название",disabled:"loading"===status,isError})}));NameInput.displayName="NameInput";try{NameInput.displayName="NameInput",NameInput.__docgenInfo={description:"",displayName:"NameInput",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/feature/AddNewTrack/ui/AddNewTrack/NameInput/NameInput.tsx#NameInput"]={docgenInfo:NameInput.__docgenInfo,name:"NameInput",path:"src/feature/AddNewTrack/ui/AddNewTrack/NameInput/NameInput.tsx#NameInput"})}catch(__react_docgen_typescript_loader_error){}var getNameSecondary=function getNameSecondary(state){var _state$addNewTrack;return null==state||null===(_state$addNewTrack=state.addNewTrack)||void 0===_state$addNewTrack?void 0:_state$addNewTrack.name_secondary},getIsNameSecondaryValidationError=function getIsNameSecondaryValidationError(state){var _state$addNewTrack,errors=null==state||null===(_state$addNewTrack=state.addNewTrack)||void 0===_state$addNewTrack?void 0:_state$addNewTrack.validationErrors.name_secondary;return(0,checkError.r)(errors)},setNameSecondary=(0,redux_toolkit_esm.hg)("AddNewTrack/setNameSecondary",function(){var _ref=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee(name_secondary,thunkApi){var dispatch;return regenerator_default().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:if(dispatch=thunkApi.dispatch," "!==name_secondary[0]){_context.next=3;break}return _context.abrupt("return");case 3:if(" "!==name_secondary[name_secondary.length-1]){_context.next=5;break}return _context.abrupt("return");case 5:dispatch(AddNewTrackActions.validateNameSecondary(name_secondary)),dispatch(AddNewTrackActions.setNameSecondary(name_secondary));case 7:case"end":return _context.stop()}}),_callee)})));return function(_x,_x2){return _ref.apply(this,arguments)}}()),NameSecondaryInput_jsx=react.createElement,NameSecondaryInput=(0,react.memo)((function(props){var dispatch=(0,store.T)(),nameSecondary=(0,es.v9)(getNameSecondary),status=(0,es.v9)(getStatus),isError=(0,es.v9)(getIsNameSecondaryValidationError),onChange=(0,react.useCallback)((function(e){dispatch(setNameSecondary(e.target.value))}),[dispatch]);return NameSecondaryInput_jsx(Input.I,{value:nameSecondary,onChange,isError,disabled:"loading"===status,label:"Дополнительная подпись"})}));NameSecondaryInput.displayName="NameSecondaryInput";try{NameSecondaryInput.displayName="NameSecondaryInput",NameSecondaryInput.__docgenInfo={description:"",displayName:"NameSecondaryInput",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/feature/AddNewTrack/ui/AddNewTrack/NameSecondaryInput/NameSecondaryInput.tsx#NameSecondaryInput"]={docgenInfo:NameSecondaryInput.__docgenInfo,name:"NameSecondaryInput",path:"src/feature/AddNewTrack/ui/AddNewTrack/NameSecondaryInput/NameSecondaryInput.tsx#NameSecondaryInput"})}catch(__react_docgen_typescript_loader_error){}var FileInput=__webpack_require__("./src/shared/ui/FileInput/index.ts"),setAudioFileMimeType=(0,redux_toolkit_esm.hg)("AddNewTrack/setAudioFileMimeType",function(){var _ref=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee(mimeType,thunkApi){var dispatch;return regenerator_default().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:(dispatch=thunkApi.dispatch)(AddNewTrackActions.validateAudioFileMimeType(mimeType)),dispatch(AddNewTrackActions.setAudioFileMimeType(mimeType));case 3:case"end":return _context.stop()}}),_callee)})));return function(_x,_x2){return _ref.apply(this,arguments)}}()),getIsAudioFileValidationError=function getIsAudioFileValidationError(state){var _state$addNewTrack,errors=null==state||null===(_state$addNewTrack=state.addNewTrack)||void 0===_state$addNewTrack?void 0:_state$addNewTrack.validationErrors.audioFile;return(0,checkError.r)(errors)},defaultValue=new FormData,FilesContext=(0,react.createContext)(defaultValue),FormDataEntries=function(FormDataEntries){return FormDataEntries.AUDIO_FILE="audio_file",FormDataEntries.IMAGE_FILE="image_file",FormDataEntries.IMAGE_CROPPED_WIDE_FILE="image_crooped_wide_file",FormDataEntries.IMAGE_CROPPED_SQUARE_FILE="image_crooped_square_file",FormDataEntries}({}),AudioInput_jsx=react.createElement,AudioInput=(0,react.memo)((function(_ref){var className=_ref.className,isError=(0,es.v9)(getIsAudioFileValidationError),dispatch=(0,store.T)(),status=(0,es.v9)(getStatus),_useFile=(0,fileStorage.TR)({formDataEntryName:FormDataEntries.AUDIO_FILE,context:FilesContext,onSetFile:function onSetFile(file){return dispatch(setAudioFileMimeType(file.type))},onDeleteFile:function onDeleteFile(){return dispatch(setAudioFileMimeType(void 0))}}),deleteFile=_useFile.deleteFile,getFile=_useFile.getFile,setFile=_useFile.setFile,onChangeFileSuccess=(0,react.useCallback)((function(file){setFile(file)}),[setFile]),onChangeFileUndefined=(0,react.useCallback)((function(){deleteFile()}),[deleteFile]),file=getFile(),fileName=null==file?void 0:file.name;return AudioInput_jsx(FileInput.S,{label:"Аудиофайл",onChangeFileSuccess,onChangeFileUndefined,disabled:"loading"===status,placeholder:"Выбрать аудиофайл...",initialFileName:fileName,isError,className})}));AudioInput.displayName="AudioInput";try{AudioInput.displayName="AudioInput",AudioInput.__docgenInfo={description:"",displayName:"AudioInput",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/feature/AddNewTrack/ui/AddNewTrack/AudioInput/AudioInput.tsx#AudioInput"]={docgenInfo:AudioInput.__docgenInfo,name:"AudioInput",path:"src/feature/AddNewTrack/ui/AddNewTrack/AudioInput/AudioInput.tsx#AudioInput"})}catch(__react_docgen_typescript_loader_error){}var getIsImageFileValidationError=function getIsImageFileValidationError(state){var _state$addNewTrack,errors=null==state||null===(_state$addNewTrack=state.addNewTrack)||void 0===_state$addNewTrack?void 0:_state$addNewTrack.validationErrors.imageFile;return(0,checkError.r)(errors)},getIsImageCroppedWideFileValidationError=function getIsImageCroppedWideFileValidationError(state){var _state$addNewTrack,errors=null==state||null===(_state$addNewTrack=state.addNewTrack)||void 0===_state$addNewTrack?void 0:_state$addNewTrack.validationErrors.imageCroppedWideFile;return(0,checkError.r)(errors)},getIsImageCroppedSquareFileValidationError=function getIsImageCroppedSquareFileValidationError(state){var _state$addNewTrack,errors=null==state||null===(_state$addNewTrack=state.addNewTrack)||void 0===_state$addNewTrack?void 0:_state$addNewTrack.validationErrors.imageCroppedSquareFile;return(0,checkError.r)(errors)},setImageCroppedSquareFileMimeType=(0,redux_toolkit_esm.hg)("AddNewTrack/setImageCroppedSquareFileMimeType",function(){var _ref=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee(mimeType,thunkApi){var dispatch;return regenerator_default().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:(dispatch=thunkApi.dispatch)(AddNewTrackActions.validateImageCroppedSquareFileMimeType(mimeType)),dispatch(AddNewTrackActions.setImageCroppedSquareFileMimeType(mimeType));case 3:case"end":return _context.stop()}}),_callee)})));return function(_x,_x2){return _ref.apply(this,arguments)}}()),setImageCroppedWideFileMimeType=(0,redux_toolkit_esm.hg)("AddNewTrack/setImageCroppedWideFileMimeType",function(){var _ref=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee(mimeType,thunkApi){var dispatch;return regenerator_default().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:(dispatch=thunkApi.dispatch)(AddNewTrackActions.validateImageCroppedWideFileMimeType(mimeType)),dispatch(AddNewTrackActions.setImageCroppedWideFileMimeType(mimeType));case 3:case"end":return _context.stop()}}),_callee)})));return function(_x,_x2){return _ref.apply(this,arguments)}}()),setImageFileMimeType=(0,redux_toolkit_esm.hg)("AddNewTrack/setImageFileMimeType",function(){var _ref=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee(mimeType,thunkApi){var dispatch,getState;return regenerator_default().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:dispatch=thunkApi.dispatch,getState=thunkApi.getState,dispatch(AddNewTrackActions.validateImageFileMimeType(mimeType)),dispatch(AddNewTrackActions.setImageFileMimeType(mimeType)),getIsImageFileValidationError(getState())||dispatch(AddNewTrackActions.setTab("cropWideImage"));case 5:case"end":return _context.stop()}}),_callee)})));return function(_x,_x2){return _ref.apply(this,arguments)}}()),ImageInput_jsx=react.createElement,ImageInput=(0,react.memo)((function(_ref){var className=_ref.className,isImageError=(0,es.v9)(getIsImageFileValidationError),isImageCroppedWideError=(0,es.v9)(getIsImageCroppedWideFileValidationError),isImageCroppedSquareError=(0,es.v9)(getIsImageCroppedSquareFileValidationError),status=(0,es.v9)(getStatus),isError=isImageError||isImageCroppedWideError||isImageCroppedSquareError,dispatch=(0,store.T)(),_useFile=(0,fileStorage.TR)({formDataEntryName:FormDataEntries.IMAGE_FILE,context:FilesContext,onSetFile:function onSetFile(file){return dispatch(setImageFileMimeType(file.type))},onDeleteFile:function onDeleteFile(){return dispatch(setImageFileMimeType(void 0))}}),setImageFile=_useFile.setFile,getImageFile=_useFile.getFile,deleteImageFile=_useFile.deleteFile,deleteImageCroppedWideFile=(0,fileStorage.TR)({formDataEntryName:FormDataEntries.IMAGE_CROPPED_WIDE_FILE,context:FilesContext,onSetFile:function onSetFile(file){return dispatch(setImageCroppedWideFileMimeType(file.type))},onDeleteFile:function onDeleteFile(){return dispatch(setImageCroppedWideFileMimeType(void 0))}}).deleteFile,deleteImageCroppedSquareFile=(0,fileStorage.TR)({formDataEntryName:FormDataEntries.IMAGE_CROPPED_WIDE_FILE,context:FilesContext,onSetFile:function onSetFile(file){return dispatch(setImageCroppedSquareFileMimeType(file.type))},onDeleteFile:function onDeleteFile(){return dispatch(setImageCroppedSquareFileMimeType(void 0))}}).deleteFile,onChangeFileSuccess=(0,react.useCallback)((function(file){setImageFile(file),deleteImageCroppedWideFile(),deleteImageCroppedSquareFile()}),[setImageFile,deleteImageCroppedWideFile,deleteImageCroppedSquareFile]),onChangeFileUndefined=(0,react.useCallback)((function(){deleteImageFile(),deleteImageCroppedWideFile(),deleteImageCroppedSquareFile()}),[deleteImageFile,deleteImageCroppedWideFile,deleteImageCroppedSquareFile]),imageFile=getImageFile(),imageFileName=null==imageFile?void 0:imageFile.name;return ImageInput_jsx(FileInput.S,{label:"Изображение",onChangeFileSuccess,onChangeFileUndefined,placeholder:"Выбрать изображение...",initialFileName:imageFileName,disabled:"loading"===status,isError,className,"data-testid":"image-input-button",inputTestId:"input"})}));ImageInput.displayName="ImageInput";try{ImageInput.displayName="ImageInput",ImageInput.__docgenInfo={description:"",displayName:"ImageInput",props:{className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/feature/AddNewTrack/ui/AddNewTrack/ImageInput/ImageInput.tsx#ImageInput"]={docgenInfo:ImageInput.__docgenInfo,name:"ImageInput",path:"src/feature/AddNewTrack/ui/AddNewTrack/ImageInput/ImageInput.tsx#ImageInput"})}catch(__react_docgen_typescript_loader_error){}var Button=__webpack_require__("./src/shared/ui/Button/index.ts"),getFieldValidationErrorMessage=__webpack_require__("./src/shared/lib/helpers/getFieldValidationErrorMessage/getFieldValidationErrorMessage.ts"),getValidationError=function getValidationError(state){var _state$addNewTrack,validationErrors=null==state||null===(_state$addNewTrack=state.addNewTrack)||void 0===_state$addNewTrack?void 0:_state$addNewTrack.validationErrors;return(0,getFieldValidationErrorMessage.A)(validationErrors,config)},next_auth_react=__webpack_require__("./node_modules/next-auth/react/index.js"),dist=__webpack_require__("./node_modules/react-hot-toast/dist/index.mjs"),getAudioFileMimeType=function getAudioFileMimeType(state){var _state$addNewTrack;return null==state||null===(_state$addNewTrack=state.addNewTrack)||void 0===_state$addNewTrack?void 0:_state$addNewTrack.audioFileMimeType},getImageFileMimeType=function getImageFileMimeType(state){var _state$addNewTrack;return null==state||null===(_state$addNewTrack=state.addNewTrack)||void 0===_state$addNewTrack?void 0:_state$addNewTrack.imageFileMimeType},upload=(0,redux_toolkit_esm.hg)("AddNewTrack/upload",function(){var _ref2=(0,asyncToGenerator.Z)(regenerator_default().mark((function _callee(_ref,thunkApi){var _session$user,_session$backendToken,imageFile,audioFile,imageCroppedSquareFile,imageCroppedWideFile,deleteAllFiles,dispatch,getState,name,name_secondary,audioFileMimeType,imageFileMimeType,session,viewerId,accessToken,error,audioFileError,imageFileError,imageCroppedWideFileError,imageCroppedSquareFileError,formData;return regenerator_default().wrap((function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return imageFile=_ref.imageFile,audioFile=_ref.audioFile,imageCroppedSquareFile=_ref.imageCroppedSquareFile,imageCroppedWideFile=_ref.imageCroppedWideFile,deleteAllFiles=_ref.deleteAllFiles,dispatch=thunkApi.dispatch,getState=thunkApi.getState,name=getName(getState()),name_secondary=getNameSecondary(getState()),audioFileMimeType=getAudioFileMimeType(getState()),imageFileMimeType=getImageFileMimeType(getState()),_context.next=8,(0,next_auth_react.getSession)();case 8:if(session=_context.sent,viewerId=null==session||null===(_session$user=session.user)||void 0===_session$user?void 0:_session$user.id,accessToken=null==session||null===(_session$backendToken=session.backendTokens)||void 0===_session$backendToken?void 0:_session$backendToken.accessToken,dispatch(AddNewTrackActions.validateName(name)),dispatch(AddNewTrackActions.validateNameSecondary(name_secondary)),dispatch(AddNewTrackActions.validateAudioFileMimeType(audioFileMimeType)),dispatch(AddNewTrackActions.validateImageFileMimeType(imageFileMimeType)),error=getValidationError(getState()),audioFileError=!audioFile,imageFileError=!imageFile,imageCroppedWideFileError=!imageCroppedWideFile,imageCroppedSquareFileError=!imageCroppedSquareFile,!error){_context.next=22;break}return _context.abrupt("return",(0,dist.ZP)("Ошибка"));case 22:if(window.navigator.onLine){_context.next=24;break}return _context.abrupt("return",(0,dist.ZP)("Ошибка. Нет соединения с интернетом"));case 24:if(viewerId&&accessToken){_context.next=26;break}return _context.abrupt("return",(0,dist.ZP)("Ошибка. Требуется авторизация"));case 26:if(!audioFileError){_context.next=28;break}return _context.abrupt("return",(0,dist.ZP)("Ошибка при загрузке аудиофайла"));case 28:if(!imageFileError){_context.next=30;break}return _context.abrupt("return",(0,dist.ZP)("Ошибка при загрузке изображения"));case 30:if(!imageCroppedWideFileError){_context.next=32;break}return _context.abrupt("return",(0,dist.ZP)("Ошибка при кадрировании изображения"));case 32:if(!imageCroppedSquareFileError){_context.next=34;break}return _context.abrupt("return",(0,dist.ZP)("Ошибка при кадрировании изображения"));case 34:return(formData=new FormData).append("name",name),formData.append("name_secondary",name_secondary||""),formData.append("audio",audioFile),formData.append("squarePicture",imageCroppedSquareFile),formData.append("widePicture",imageCroppedWideFile),formData.append("feats_ids",JSON.stringify([])),formData.append("owners_ids",JSON.stringify([])),_context.prev=42,dispatch(AddNewTrackActions.startLoad()),_context.next=46,fetch(backendUrl.A+"/tracks-private/upload",{method:"POST",body:formData,headers:{Authorization:"Bearer "+accessToken}});case 46:if(201==_context.sent.status){_context.next=50;break}return dispatch(AddNewTrackActions.setIdle()),_context.abrupt("return",(0,dist.ZP)("Ошибка во время загрузки на сервер"));case 50:(0,dist.ZP)("Сохранено"),dispatch(AddNewTrackActions.reset()),deleteAllFiles(),dispatch(AddNewTrackActions.setIdle()),_context.next=60;break;case 56:_context.prev=56,_context.t0=_context.catch(42),(0,dist.ZP)("Ошибка во время загрузки на сервер"),dispatch(AddNewTrackActions.setIdle());case 60:case"end":return _context.stop()}}),_callee,null,[[42,56]])})));return function(_x,_x2){return _ref2.apply(this,arguments)}}()),Submit_jsx=react.createElement,Submit=function Submit(props){var error=(0,es.v9)(getValidationError),dispatch=(0,store.T)(),status=(0,es.v9)(getStatus),getFile=(0,fileStorage.ii)({context:FilesContext}),deleteAllFiles=(0,fileStorage.$C)({context:FilesContext,formDataEntryNames:[FormDataEntries.AUDIO_FILE,FormDataEntries.IMAGE_CROPPED_SQUARE_FILE,FormDataEntries.IMAGE_CROPPED_WIDE_FILE,FormDataEntries.IMAGE_FILE]}),onSubmit=(0,react.useCallback)((function(e){e.preventDefault(),dispatch(upload({audioFile:getFile(FormDataEntries.AUDIO_FILE),imageFile:getFile(FormDataEntries.IMAGE_FILE),imageCroppedSquareFile:getFile(FormDataEntries.IMAGE_CROPPED_SQUARE_FILE),imageCroppedWideFile:getFile(FormDataEntries.IMAGE_CROPPED_WIDE_FILE),deleteAllFiles}))}),[dispatch,getFile,deleteAllFiles]);return Submit_jsx(Button.z,{variant:"green",disabled:Boolean(error)&&"loading"!==status,onClick:onSubmit,fullwidth:!0},"idle"===status?"Загрузить":"Зыгрузка...")};Submit.displayName="Submit",Submit.__docgenInfo={description:"",methods:[],displayName:"Submit"};try{Submit.displayName="Submit",Submit.__docgenInfo={description:"",displayName:"Submit",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/feature/AddNewTrack/ui/AddNewTrack/Submit/Submit.tsx#Submit"]={docgenInfo:Submit.__docgenInfo,name:"Submit",path:"src/feature/AddNewTrack/ui/AddNewTrack/Submit/Submit.tsx#Submit"})}catch(__react_docgen_typescript_loader_error){}var FormError_jsx=react.createElement,FormError=function FormError(props){var error=(0,es.v9)(getValidationError);if(error)return FormError_jsx(ui_Form.l.Box,{margin:"auto"},error)};FormError.displayName="FormError",FormError.__docgenInfo={description:"",methods:[],displayName:"FormError"};try{FormError.displayName="FormError",FormError.__docgenInfo={description:"",displayName:"FormError",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/feature/AddNewTrack/ui/AddNewTrack/FormError/FormError.tsx#FormError"]={docgenInfo:FormError.__docgenInfo,name:"FormError",path:"src/feature/AddNewTrack/ui/AddNewTrack/FormError/FormError.tsx#FormError"})}catch(__react_docgen_typescript_loader_error){}var Form_jsx=react.createElement,Form=function Form(props){return Form_jsx(react.Fragment,null,Form_jsx(ui_Form.l,{margin:"auto",className:Form_Form_module.form},Form_jsx(NameInput,null),Form_jsx(NameSecondaryInput,null),Form_jsx(AudioInput,null),Form_jsx(ImageInput,{className:Form_Form_module.last_input}),Form_jsx(Submit,null)),Form_jsx(FormError,null))};Form.__docgenInfo={description:"",methods:[],displayName:"Form"};try{Form.displayName="Form",Form.__docgenInfo={description:"",displayName:"Form",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/feature/AddNewTrack/ui/AddNewTrack/Form/Form.tsx#Form"]={docgenInfo:Form.__docgenInfo,name:"Form",path:"src/feature/AddNewTrack/ui/AddNewTrack/Form/Form.tsx#Form"})}catch(__react_docgen_typescript_loader_error){}var CropImage=__webpack_require__("./src/shared/ui/CropImage/index.ts"),CropWideImage_jsx=react.createElement,CropWideImage=function CropWideImage(){var dispatch=(0,store.T)(),_useFile=(0,fileStorage.TR)({formDataEntryName:FormDataEntries.IMAGE_FILE,context:FilesContext,onSetFile:function onSetFile(file){return dispatch(setImageFileMimeType(file.type))},onDeleteFile:function onDeleteFile(){return dispatch(setImageFileMimeType(void 0))}}),deleteImageFile=_useFile.deleteFile,getImageFile=_useFile.getFile,_useFile2=(0,fileStorage.TR)({formDataEntryName:FormDataEntries.IMAGE_CROPPED_WIDE_FILE,context:FilesContext,onSetFile:function onSetFile(file){return dispatch(setImageCroppedWideFileMimeType(file.type))},onDeleteFile:function onDeleteFile(){return dispatch(setImageCroppedWideFileMimeType(void 0))}}),deleteImageCroppedWideFile=_useFile2.deleteFile,setImageCroppedWideFile=_useFile2.setFile,deleteImageCroppedSquareFile=(0,fileStorage.TR)({formDataEntryName:FormDataEntries.IMAGE_CROPPED_WIDE_FILE,context:FilesContext,onSetFile:function onSetFile(file){return dispatch(setImageCroppedSquareFileMimeType(file.type))},onDeleteFile:function onDeleteFile(){return dispatch(setImageCroppedSquareFileMimeType(void 0))}}).deleteFile,image=getImageFile(),onCancel=(0,react.useCallback)((function(){deleteImageCroppedWideFile(),deleteImageFile(),deleteImageCroppedSquareFile(),dispatch(AddNewTrackActions.setTab("form"))}),[deleteImageCroppedWideFile,dispatch,deleteImageCroppedSquareFile,deleteImageFile]),onSuccess=(0,react.useCallback)((function(file){setImageCroppedWideFile(file),dispatch(AddNewTrackActions.setTab("cropSquareImage"))}),[setImageCroppedWideFile,dispatch]);return CropWideImage_jsx(CropImage.N,{imageFileURL:image?URL.createObjectURL(image):void 0,onCancel,onSuccess,aspectRatio:16/9,submitButtonText:"Продолжить",cancelButtonText:"Отменить",info:"Обрежьте изображение для плеера",minHeight:1080,minWidth:1920,title:"Плеер",testId:"crop-wide",continueButtonTestId:"wide-continue"})};CropWideImage.displayName="CropWideImage",CropWideImage.__docgenInfo={description:"",methods:[],displayName:"CropWideImage"};try{CropWideImage.displayName="CropWideImage",CropWideImage.__docgenInfo={description:"",displayName:"CropWideImage",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/feature/AddNewTrack/ui/AddNewTrack/CropWideImage/CropWideImage.tsx#CropWideImage"]={docgenInfo:CropWideImage.__docgenInfo,name:"CropWideImage",path:"src/feature/AddNewTrack/ui/AddNewTrack/CropWideImage/CropWideImage.tsx#CropWideImage"})}catch(__react_docgen_typescript_loader_error){}var CropSquareImage_jsx=react.createElement,CropSquareImage=function CropSquareImage(){var dispatch=(0,store.T)(),_useFile=(0,fileStorage.TR)({formDataEntryName:FormDataEntries.IMAGE_FILE,context:FilesContext,onSetFile:function onSetFile(file){return dispatch(setImageFileMimeType(file.type))},onDeleteFile:function onDeleteFile(){return dispatch(setImageFileMimeType(void 0))}}),deleteImageFile=_useFile.deleteFile,getImageFile=_useFile.getFile,deleteImageCroppedWideFile=(0,fileStorage.TR)({formDataEntryName:FormDataEntries.IMAGE_CROPPED_WIDE_FILE,context:FilesContext,onSetFile:function onSetFile(file){return dispatch(setImageCroppedWideFileMimeType(file.type))},onDeleteFile:function onDeleteFile(){return dispatch(setImageCroppedWideFileMimeType(void 0))}}).deleteFile,_useFile3=(0,fileStorage.TR)({formDataEntryName:FormDataEntries.IMAGE_CROPPED_SQUARE_FILE,context:FilesContext,onSetFile:function onSetFile(file){return dispatch(setImageCroppedSquareFileMimeType(file.type))},onDeleteFile:function onDeleteFile(){return dispatch(setImageCroppedSquareFileMimeType(void 0))}}),deleteImageCroppedSquareFile=_useFile3.deleteFile,setImageCroppedSquareFile=_useFile3.setFile,image=getImageFile(),onCancel=(0,react.useCallback)((function(){deleteImageCroppedSquareFile(),deleteImageFile(),deleteImageCroppedWideFile(),dispatch(AddNewTrackActions.setTab("form"))}),[deleteImageCroppedWideFile,dispatch,deleteImageCroppedSquareFile,deleteImageFile]),onSuccess=(0,react.useCallback)((function(file){setImageCroppedSquareFile(file),dispatch(AddNewTrackActions.setTab("form"))}),[setImageCroppedSquareFile,dispatch]);return CropSquareImage_jsx(CropImage.N,{imageFileURL:image?URL.createObjectURL(image):void 0,onCancel,onSuccess,aspectRatio:1,submitButtonText:"Продолжить",cancelButtonText:"Отменить",info:"Обрежьте изображение для миниатюры",minHeight:900,minWidth:900,title:"Миниатюра",testId:"crop-square",continueButtonTestId:"square-continue"})};CropSquareImage.displayName="CropSquareImage",CropSquareImage.__docgenInfo={description:"",methods:[],displayName:"CropSquareImage"};try{CropSquareImage.displayName="CropSquareImage",CropSquareImage.__docgenInfo={description:"",displayName:"CropSquareImage",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/feature/AddNewTrack/ui/AddNewTrack/CropSquareImage/CropSquareImage.tsx#CropSquareImage"]={docgenInfo:CropSquareImage.__docgenInfo,name:"CropSquareImage",path:"src/feature/AddNewTrack/ui/AddNewTrack/CropSquareImage/CropSquareImage.tsx#CropSquareImage"})}catch(__react_docgen_typescript_loader_error){}var _Idle$parameters,_Idle$parameters2,_Loading$parameters,_Loading$parameters2,getTab=function getTab(state){var _state$addNewTrack;return null==state||null===(_state$addNewTrack=state.addNewTrack)||void 0===_state$addNewTrack?void 0:_state$addNewTrack.tab},AddNewTrack_jsx=react.createElement,Tabs={form:AddNewTrack_jsx(Form,null),cropSquareImage:AddNewTrack_jsx(CropSquareImage,null),cropWideImage:AddNewTrack_jsx(CropWideImage,null)},reducers={addNewTrack:AddNewTrackReducer},AddNewTrack=(0,react.memo)((function(){var tab=(0,es.v9)(getTab);return AddNewTrack_jsx(DynamicModuleLoader.W,{reducers,removeAfterUnmount:!0},AddNewTrack_jsx(fileStorage.pW,{formDataEntriesNames:[FormDataEntries.AUDIO_FILE,FormDataEntries.IMAGE_CROPPED_SQUARE_FILE,FormDataEntries.IMAGE_CROPPED_WIDE_FILE,FormDataEntries.IMAGE_FILE],Context:FilesContext},tab&&Tabs[tab]))}));AddNewTrack.displayName="AddNewTrack";try{AddNewTrack.displayName="AddNewTrack",AddNewTrack.__docgenInfo={description:"",displayName:"AddNewTrack",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/feature/AddNewTrack/ui/AddNewTrack/AddNewTrack.tsx#AddNewTrack"]={docgenInfo:AddNewTrack.__docgenInfo,name:"AddNewTrack",path:"src/feature/AddNewTrack/ui/AddNewTrack/AddNewTrack.tsx#AddNewTrack"})}catch(__react_docgen_typescript_loader_error){}function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){(0,defineProperty.Z)(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}const AddNewTrack_stories={title:"feature/AddNewTrack (client)",component:AddNewTrack,tags:["autodocs"]};var args={},Idle={args,parameters:{mockData:[{url:backendUrl.A+"/tracks-private/upload",method:"POST",status:201,response:"",delay:3e3}]},decorators:[(0,StoreDecorator.l)({addNewTrack:{audioFileMimeType:void 0,imageCroppedSquareMimeType:void 0,imageCroppedWideMimeType:void 0,imageFileMimeType:void 0,name:void 0,name_secondary:void 0,status:"idle",tab:"form",validationErrors:{name:{empty:!1,exceedsMaxLenght:!1},name_secondary:{exceedsMaxLenght:!1},audioFile:{invalidMimeType:!1,empty:!1},imageFile:{invalidMimeType:!1,empty:!1},imageCroppedSquareFile:{empty:!1},imageCroppedWideFile:{empty:!1}}}})]},Loading={args,parameters:{mockData:[{url:backendUrl.A+"/tracks-private/upload",method:"POST",status:500,response:"",delay:3e3}]},decorators:[(0,StoreDecorator.l)({addNewTrack:{audioFileMimeType:void 0,imageCroppedSquareMimeType:void 0,imageCroppedWideMimeType:void 0,imageFileMimeType:void 0,name:void 0,name_secondary:void 0,status:"loading",tab:"form",validationErrors:{name:{empty:!1,exceedsMaxLenght:!1},name_secondary:{exceedsMaxLenght:!1},audioFile:{invalidMimeType:!1,empty:!1},imageFile:{invalidMimeType:!1,empty:!1},imageCroppedSquareFile:{empty:!1},imageCroppedWideFile:{empty:!1}}}})]};Idle.parameters=_objectSpread(_objectSpread({},Idle.parameters),{},{docs:_objectSpread(_objectSpread({},null===(_Idle$parameters=Idle.parameters)||void 0===_Idle$parameters?void 0:_Idle$parameters.docs),{},{source:_objectSpread({originalSource:"{\n  args,\n  parameters: {\n    mockData: [{\n      url: backendUrl + '/tracks-private/upload',\n      method: 'POST',\n      status: 201,\n      response: '',\n      delay: 3000\n    }]\n  },\n  decorators: [StoreDecorator({\n    addNewTrack: {\n      audioFileMimeType: undefined,\n      imageCroppedSquareMimeType: undefined,\n      imageCroppedWideMimeType: undefined,\n      imageFileMimeType: undefined,\n      name: undefined,\n      name_secondary: undefined,\n      status: 'idle',\n      tab: 'form',\n      validationErrors: {\n        name: {\n          empty: false,\n          exceedsMaxLenght: false\n        },\n        name_secondary: {\n          exceedsMaxLenght: false\n        },\n        audioFile: {\n          invalidMimeType: false,\n          empty: false\n        },\n        imageFile: {\n          invalidMimeType: false,\n          empty: false\n        },\n        imageCroppedSquareFile: {\n          empty: false\n        },\n        imageCroppedWideFile: {\n          empty: false\n        }\n      }\n    }\n  })]\n}"},null===(_Idle$parameters2=Idle.parameters)||void 0===_Idle$parameters2||null===(_Idle$parameters2=_Idle$parameters2.docs)||void 0===_Idle$parameters2?void 0:_Idle$parameters2.source)})}),Loading.parameters=_objectSpread(_objectSpread({},Loading.parameters),{},{docs:_objectSpread(_objectSpread({},null===(_Loading$parameters=Loading.parameters)||void 0===_Loading$parameters?void 0:_Loading$parameters.docs),{},{source:_objectSpread({originalSource:"{\n  args,\n  parameters: {\n    mockData: [{\n      url: backendUrl + '/tracks-private/upload',\n      method: 'POST',\n      status: 500,\n      response: '',\n      delay: 3000\n    }]\n  },\n  decorators: [StoreDecorator({\n    addNewTrack: {\n      audioFileMimeType: undefined,\n      imageCroppedSquareMimeType: undefined,\n      imageCroppedWideMimeType: undefined,\n      imageFileMimeType: undefined,\n      name: undefined,\n      name_secondary: undefined,\n      status: 'loading',\n      tab: 'form',\n      validationErrors: {\n        name: {\n          empty: false,\n          exceedsMaxLenght: false\n        },\n        name_secondary: {\n          exceedsMaxLenght: false\n        },\n        audioFile: {\n          invalidMimeType: false,\n          empty: false\n        },\n        imageFile: {\n          invalidMimeType: false,\n          empty: false\n        },\n        imageCroppedSquareFile: {\n          empty: false\n        },\n        imageCroppedWideFile: {\n          empty: false\n        }\n      }\n    }\n  })]\n}"},null===(_Loading$parameters2=Loading.parameters)||void 0===_Loading$parameters2||null===(_Loading$parameters2=_Loading$parameters2.docs)||void 0===_Loading$parameters2?void 0:_Loading$parameters2.source)})})},"./node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[13].use[1]!./node_modules/postcss-loader/dist/cjs.js!./node_modules/resolve-url-loader/index.js!./node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[13].use[4]!./src/feature/AddNewTrack/ui/AddNewTrack/Form/Form.module.scss":(module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__});var _node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/css-loader/dist/runtime/sourceMaps.js"),_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0__),_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/css-loader/dist/runtime/api.js"),___CSS_LOADER_EXPORT___=__webpack_require__.n(_node_modules_css_loader_dist_runtime_api_js__WEBPACK_IMPORTED_MODULE_1__)()(_node_modules_css_loader_dist_runtime_sourceMaps_js__WEBPACK_IMPORTED_MODULE_0___default());___CSS_LOADER_EXPORT___.push([module.id,".Form_last_input__TPi_T{margin-bottom:16px}.Form_form__3M4ib{margin-bottom:16px}","",{version:3,sources:["webpack://./src/feature/AddNewTrack/ui/AddNewTrack/Form/Form.module.scss"],names:[],mappings:"AAAA,wBACI,kBAAA,CAGJ,kBACI,kBAAA",sourcesContent:[".last_input {\r\n    margin-bottom: 16px;\r\n}\r\n\r\n.form {\r\n    margin-bottom: 16px;\r\n}"],sourceRoot:""}]),___CSS_LOADER_EXPORT___.locals={last_input:"Form_last_input__TPi_T",form:"Form_form__3M4ib"};const __WEBPACK_DEFAULT_EXPORT__=___CSS_LOADER_EXPORT___}}]);